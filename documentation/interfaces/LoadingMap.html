<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>dynamic-angular-crud documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">dynamic-angular-crud documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>LoadingMap</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/shared/crud-service/data.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>A mapping of every DB table to a load boolean so that external components can wait for a table&#39;s data to be loaded</p>

            </p>




            <section>
    <h3 id="inputs">Indexable</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <code>[tableName: string]:    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="136" class="link-to-prism">src/app/shared/crud-service/data.service.ts:136</a></div>
                            </td>
                        </tr>
            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { HttpClient, HttpHeaders, HttpParams } from &#x27;@angular/common/http&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { Observable, Subject } from &#x27;rxjs&#x27;;

import { environment } from &#x27;../../../environments/environment&#x27;;
import { TableMap } from &#x27;../table-map&#x27;;
import { DataCreate } from &#x27;./_create&#x27;;
import { DataDelete } from &#x27;./_delete&#x27;;
import { DataRead } from &#x27;./_read&#x27;;
import { DataUpdate } from &#x27;./_update&#x27;;

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class DataService {
  endpoint: string &#x3D; environment.serverUrl;

  // Define header options to be applied to all requests
  httpOptions &#x3D; {
    headers: new HttpHeaders({
      &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      // &#x27;Authorization&#x27;: &#x27;my-auth-token&#x27;
    }),
    params: new HttpParams()
  };

  // Determine whether or not to be optimstic with our Http calls in terms of updating the front end. True means update the front end right away despite what the server does.
  isOptimistic &#x3D; true;

  // A simple object that is used a cache for any data that has been loaded into the system
  cache: any &#x3D; {};
  // A map of TableName &#x3D;&gt; Subject for external components to subscribe to, in order to be notified of updates to that table&#x27;s data
  subjectMap: SubjectMap &#x3D; {};
  // A map of TableName &#x3D;&gt; Boolean to components to use for displaying a loading icon when that table&#x27;s data is being loaded or modified
  loadingMap: LoadingMap &#x3D; {};

  constructor(
    private http: HttpClient,
    private DC: DataCreate,
    private DR: DataRead,
    private DU: DataUpdate,
    private DD: DataDelete
  ) {
    this.DC.setDataService(this);
    this.DR.setDataService(this);
    this.DU.setDataService(this);
    this.DD.setDataService(this);

    this.setupLocalProps();
  }

  private setupLocalProps() {
    // TODO: Figure out how to make a subject with the correct TS model based on the table name
    Object.keys(TableMap).forEach(tableName &#x3D;&gt; {
      this.loadingMap[TableMap[tableName]] &#x3D; false;
      this.cache[TableMap[tableName]] &#x3D; [];
      this.subjectMap[TableMap[tableName]] &#x3D; {
        many: new Subject&lt;any[]&gt;(),
        one: new Subject&lt;any&gt;()
      };
    });
  }

  /**
   * PUBLIC API
   */

  // CREATE
  create&lt;T&gt;(model: T | any, objToCreate?: T | any) {
    this.DC.create(model, objToCreate);
  }

  createObs&lt;T&gt;(model: T | any, objToCreate?: T | any): Observable&lt;T | T[]&gt; {
    return this.DC.createObs(model, objToCreate);
  }

  createPromise&lt;T&gt;(model: T | any, objToCreate: T | any): Promise&lt;T | any&gt; {
    return this.DC.createPromise(model, objToCreate);
  }

  // READ
  read&lt;T&gt;(model: T | any, query?: HttpParams | String) {
    this.DR.read(model, query);
  }

  readObs&lt;T&gt;(model: T | any, query?: HttpParams | String): Observable&lt;T[]&gt; {
    return this.DR.readObs(model, query);
  }

  readPromise&lt;T&gt;(model: T | any, query?: HttpParams | String): Promise&lt;T | any&gt; {
    return this.DR.readPromise(model, query);
  }

  // UPDATE
  update&lt;T&gt;(model: T | any, objToUpdate: T | any) {
    this.DU.update(model, objToUpdate);
  }

  updateObs&lt;T&gt;(model: T | any, objToUpdate: T | any): Observable&lt;T[]&gt; {
    return this.DU.updateObs(model, objToUpdate);
  }

  updatePromise&lt;T&gt;(model: T | any, objToUpdate: T | any): Promise&lt;T | any&gt; {
    return this.DU.updatePromise(model, objToUpdate);
  }

  // DELETE
  delete&lt;T&gt;(model: T | any, objToDelete: T | any, stopNotify?: boolean) {
    this.DD.delete(model, objToDelete, stopNotify);
  }
  
  deleteObs&lt;T&gt;(model: T | any, objToDelete: T | any): Observable&lt;T[]&gt; {
    return this.DD.deleteObs(model, objToDelete);
  }
  
  deletePromise&lt;T&gt;(model: T | any, objToDelete: T | any): Promise&lt;T | any&gt; {
    return this.DD.deletePromise(model, objToDelete);
  }
}

/**
 * A mapping of every environment defined DB table to a subject so that CRUD applications can send notifications to all subject subscribers
 * Components can subscribe to the &quot;many&quot; subject to receive an array of new objects, or to the &quot;one&quot; subject to get a single object
 * TODO: Investigate and Spread this into an individual CRUD subject for each table
 */
interface SubjectMap {
  [tableName: string]: {
    many: Subject&lt;any[]&gt;;
    one: Subject&lt;any&gt;;
  };
}

/**
 * A mapping of every DB table to a load boolean so that external components can wait for a table&#x27;s data to be loaded
 */
interface LoadingMap {
  [tableName: string]: boolean;
}

/**
 * A simple cache which is an object whose properties is a table name with an array of that table&#x27;s data loaded into the front end
 */
interface Cache {
  [tableName: string]: any[];
}

/**
 * An interface for what we expect to be used for dynamic Table CRUD
 */
interface TableCRUD {
  cache: Cache;
  subjectMap: SubjectMap;
  loadingMap: LoadingMap;
}</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'LoadingMap.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
